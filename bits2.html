<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Glen Doman's Method - UI Shell</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script type="text/javascript" src="speech.js"></script>
    <!-- Google Fonts: Inter -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        /* Custom Styles */
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            background-color: #111827; /* gray-900 */
        }

        /* Hide scrollbar */
        body::-webkit-scrollbar {
            display: none;
        }

        /* Custom toggle switch style */
        .toggle-checkbox:checked {
            right: 0;
            border-color: #4f46e5; /* indigo-600 */
        }
        .toggle-checkbox:checked + .toggle-label {
            background-color: #4f46e5; /* indigo-600 */
        }

        #slide-container {
            --m: 4px; --t: 81px; --b:var(--m); 
            width: calc(100% - calc(var(--m) * 2)); height: calc(100% - var(--t) - var(--b)); margin: var(--t) var(--m) var(--b) var(--m); position: fixed; top: 0; left: 0;            
        }
    </style>
</head>
<body class="bg-gray-900 text-white overflow-hidden">

    <!-- Main Application Container -->
    <div id="app-container" class="w-full h-screen relative hidden">
        <!-- Top Right Controls -->
        <div id="top-controls" class="absolute top-6 right-6 z-20 flex items-center space-x-4">
            <!-- Play/Pause Button -->
            <button id="play-pause-btn" onclick="UI.onClick_Play()" class="w-12 h-12 flex items-center justify-center bg-indigo-600 hover:bg-indigo-500 rounded-full transition-colors shadow-lg">
                <svg id="pause-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="hidden"><rect x="6" y="4" width="4" height="16"></rect><rect x="14" y="4" width="4" height="16"></rect></svg>
                <svg id="play-icon" xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="currentColor" stroke="currentColor" stroke-width="1" stroke-linecap="round" stroke-linejoin="round" class="ml-1"><path d="M5 3l14 9-14 9V3z"></path></svg>
            </button>

            <!-- Mode Toggle Switch -->
            <div class="flex items-center space-x-2 text-sm">
                <span>Continuous</span>
                <div class="relative inline-block w-10 mr-2 align-middle select-none transition duration-200 ease-in">
                    <input type="checkbox" name="toggle" id="mode-toggle" class="toggle-checkbox absolute block w-6 h-6 rounded-full bg-white border-4 appearance-none cursor-pointer"/>
                    <label for="mode-toggle" class="toggle-label block overflow-hidden h-6 rounded-full bg-gray-600 cursor-pointer"></label>
                </div>
                <span>Test</span>
            </div>

            <!-- Info Button -->
            <button onclick="UI.onClick_Info(true)" class="w-10 h-10 flex items-center justify-center bg-gray-800/50 hover:bg-gray-700/70 rounded-full transition-colors backdrop-blur-sm">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"></circle><line x1="12" y1="16" x2="12" y2="12"></line><line x1="12" y1="8" x2="12.01" y2="8"></line></svg>
            </button>
        </div>
        <!-- Container for slides -->
        <div id="slide-container" class="flex items-center justify-center">
             <h2 class="text-2xl text-gray-500">Press Play to Start</h2>
        </div>
    </div>

    <!-- Initial Start Screen -->
    <div id="start-screen" class="w-full h-screen flex items-center justify-center z-10">
        <div class="text-center p-8 max-w-2xl">
            <h1 class="text-4xl md:text-5xl font-bold mb-4">Glen Doman's Method</h1>
            <p class="text-gray-300 md:text-lg mb-8">
                This interactive experience is based on Glen Doman's method of early childhood education, using "bits of information" to stimulate a child's capacity for learning.
            </p>
            <button onclick="UI.onClick_StartApp()" class="bg-indigo-600 hover:bg-indigo-500 text-white font-bold py-3 px-8 rounded-full text-lg transition-transform transform hover:scale-105">
                Start
            </button>
        </div>
    </div>

    <!-- Info Modal -->
    <div id="info-modal" class="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4 hidden backdrop-blur-sm">
        <div class="bg-gray-800 rounded-2xl p-8 max-w-2xl w-full relative shadow-2xl">
            <button onclick="UI.onClick_Info(false)" class="absolute top-4 right-4 text-gray-400 hover:text-white">
                <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><line x1="18" y1="6" x2="6" y2="18"></line><line x1="6" y1="6" x2="18" y2="18"></line></svg>
            </button>
            <h2 class="text-2xl font-bold mb-4">About Glen Doman's Ideas</h2>
            <div class="space-y-4 text-gray-300">
                <p>
                    Glen Doman's method emphasizes the power of early education. Using bits of information, such as numbers represented by dots on cards, he believed that children could develop an exceptional capacity for learning when their natural curiosity is nurtured.
                </p>
                <p>
                    By presenting information in a simple, clear, and repetitive way, parents can encourage their children to grasp complex ideas effortlessly. His methods have inspired many to engage children with interactive and stimulating learning experiences.
                </p>
            </div>
        </div>
    </div>

    <script>
        const _$ = id => document.getElementById(id);
        const _cl = id => _$(id).classList;
        async function numToWords(number, lang){
          // ensure dependency is loaded
          if (!window.n2words){
            await new Promise((resolve, reject)=>{
              const s=document.createElement('script');
              s.src="https://cdn.jsdelivr.net/npm/n2words@1.23.0/dist/n2words.min.js";
              s.onload=()=>resolve();
              s.onerror=()=>reject(new Error("failed to load n2words"));
              document.head.appendChild(s);
            });
          }
          if (typeof window.n2words !== 'function') throw new Error("n2words not available");
          return window.n2words(Number(number), { lang });
        }

        const UI = {
            getMode() { return _$('mode-toggle').checked ? 'test' : 'continuous'; },
            play() { _cl('pause-icon').remove('hidden'); _cl('play-icon').add('hidden'); },
            pause() { _cl('pause-icon').add('hidden'); _cl('play-icon').remove('hidden'); },
            slideContainer() { return _$('slide-container'); },
            start(g) { UI.generator = g; },
            onClick_StartApp() { _cl('start-screen').add('hidden'); _cl('app-container').remove('hidden'); },
            onClick_Info(s) { _cl('info-modal').toggle('hidden', !s); },
            isPlaying() {
                if (!_cl('info-modal').contains('hidden')) return false;
                return !_cl('pause-icon').contains('hidden');
            },
            displaySlide(d) {
                const c = _$('slide-container');
                if (c) {
                    c.innerHTML = '';
                    c.appendChild(d);
                }
            },
            onClick_Play() {
                if (!_cl('pause-icon').contains('hidden')) {
                    UI.pause();
                } else {
                    UI.play();
                    UI.generator.nextSlide();
                }
            },
            lang(){
                return 'es-CO';
            }
        };
        class CircleGenerator extends SlideGenerator {
            constructor(isRandomSize = true) {
                super();
                this.isRandomSize = isRandomSize;
            }

            drawNext(n=null) {
                this.currentNumber = n || (Math.floor(Math.random() * 15) + 1);
                this.slide = createCanvasWithCircles(this.currentNumber, true, UI.slideContainer());
                UI.displaySlide(this.slide);
            }

            async awaitContinuous() {
                await Speech.speak(this.currentNumber.toString(), UI.lang());
                this.timeout = setTimeout(() => this.nextSlide(), 3000);
            }

            async awaitTest() {
                let success = false;
                while(!success){
                    if(!UI.isPlaying()) return;
                    const N = this.currentNumber;
                    const L = UI.lang();
                    success = (await Speech.listen([`${N}`, await numToWords(N, L)], L, 7000)).success;
                    if(success) {
                        return this.nextSlide();
                    }
                    await Speech.speak(this.currentNumber.toString(), L);
                }
            }
        }
        const G = new CircleGenerator(false);
        window.Generator = G;
        UI.start(G);
    </script>
</body>
</html>
